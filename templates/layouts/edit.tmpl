{{ define "title" }}<title>{{ .PageTitle }} - Editing</title>{{ end }}
{{ define "sidebar" }}
    {{ template "sidebar_nav" . }}
    {{ template "login_form" . }}
{{ end }}
{{ define "content" }}
<link rel="stylesheet" href="/s/css/jquery.tagsinput.min.css">
<ul class="breadcrumbs">
  <li><a href="/{{.Filename}}">{{ .PageTitle }}</a></li>
  <li class="current"><a href="/{{.Filename}}/edit">Edit</a></li>
  <li><a href="/{{.Filename}}/history">History</a></li>
</ul>
<div class="panel callout radius">
  <h1>{{.PageTitle}}</h1>
</div>
<div class="panel radius">
  <form action="/{{.Filename}}/save" method="POST" id="savewiki">
  Title:<input type="text" name="title" value="{{.Title}}"><br>
  Tags:<input type="text" name="tags" id="tags" value="{{.Tags}}"><br>
  <input type="hidden" name="token" value="{{.Token}}">
  <h5>Note: private tag=private page.</h5>
  <textarea name="editor"></textarea>
  <input type="submit" class="button success" value="Submit">
  <a href="#" data-reveal-id="previewModal" class="button">Preview</a>
  </form>
</div>
<div id="previewModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
  <h2 id="modalTitle">{{.PageTitle }} - Preview</h2>
  <div id="preview" class="panel callout"></div>
  <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>

{{ end }}
{{ define "extra_scripts" }}
<script src="/s/js/commonmark.js"></script>
<script src="/s/js/jquery.tagsinput.min.js"></script>
<script type="text/javascript" charset="utf-8">
 
$('#tags').tagsInput({
   'height':'3rem',
   'width':'100%',
});
var commonmark = window.commonmark;
var writer = new commonmark.HtmlRenderer();
var reader = new commonmark.Parser();
var textarea = $("#editor");
var initial_text = {{printf "%s" .wiki.Content}};

document.getElementsByName("editor")[0].value = initial_text;

$(document).foundation(); 
//$(document).foundation('tab', 'reflow');
$(document).foundation('reveal', 'reflow');

$(document).on('open.fndtn.reveal', '[data-reveal]', function () {
    var editortxt = document.getElementsByName("editor")[0].value;
    var parsed = reader.parse(editortxt);
    var result = writer.render(parsed);  
    $("#preview").html(result);
});

</script>
{{ end }}