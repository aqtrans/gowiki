{{ define "title" }}<title>{{ .Title }} - {{.Title }}</title>{{ end }}
{{ define "sidebar" }}
    {{ template "sidebar_nav" . }}
{{ end }}
{{ define "content" }}     
<h1>Editing {{.Title}}</h1>
{{$title := .Title}}
<hr />
<form action="/save/{{.Title}}" method="POST">
<div id="editor"></div>
</form>
{{ end }}
{{ define "extra_scripts" }}
<link rel="stylesheet" href="/css/commonmark.editor-0.3.1.min.css" />
<script src="http://spec.commonmark.org/js/commonmark.js"></script>
<script src="/js/commonmark.editor-0.3.1.min.js"></script>
<script type="text/javascript" charset="utf-8">
$(function() {
    var editor = $('#editor').commonMarkEditor({ save: true, title: {{.Title}}, name: "#editor", text: {{printf "%s" .Content}} });
    editor[0].on.change(function(e) {
        $.post( "/api/save/{{.Title}}", e.text, function(data){
            if(data.success){
              $(".alerts").append("<div class=\"alert-box success\" data-alert>Wiki successfully updated! <a style='color:#fff' href=/"+data.name+"><i class='fa fa-external-link'></i>[Wiki page]</a><a class=\"close\">&times;</a></div>");
              $(document).foundation('alert','reflow');
            } else {
              $(".alerts").append("<div class=\"alert-box alert\" data-alert>Failed to save page<a class=\"close\">&times;</a></div>");
              $(document).foundation('alert','reflow');
            }
        });
    });
});
</script>
{{ end }}